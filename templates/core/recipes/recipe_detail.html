{% extends 'base.html' %}
{% load static %}

{% block title %}{{ receta.nombre }} - RecetaAI{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/recipe-detail.css' %}" />
{% endblock %}

{% block content %}
<div class="recipe-detail-wrapper">
  <!-- Header -->
  <div class="recipe-header">
    <h1 class="page-title">Detalle de Receta</h1>
    <p class="page-subtitle">Instrucciones completas paso a paso</p>
  </div>

  <!-- Main Layout -->
  <div class="recipe-layout">
    <!-- Left Column -->
    <div class="recipe-left-column">
      <div class="recipe-image-card">
        {% if receta.image_url %}
          <img src="{{ receta.image_url }}" alt="{{ receta.nombre }}" class="recipe-main-image">
        {% else %}
          <img src="{% static 'media/placeholders/recipe-placeholder.jpg' %}" alt="{{ receta.nombre }}" class="recipe-main-image">
        {% endif %}
      </div>

      <div class="recipe-info-card">
        <h2 class="recipe-title">{{ receta.nombre }}</h2>
        <div class="recipe-rating">
          <i class="fas fa-star"></i>
          <span class="rating-value">{{ receta.valoracion|default:"0.0" }}</span>
        </div>
        {% if receta.descripcion %}
          <p class="recipe-description">{{ receta.descripcion }}</p>
        {% endif %}

        <div class="recipe-meta">
          <div class="meta-item">
            <i class="far fa-clock"></i>
            <span>{% if receta.duracion %}{{ receta.duracion }} min{% else %}-{% endif %}</span>
          </div>
          <div class="meta-item">
            <i class="fas fa-users"></i>
            <span>{{ receta.porciones }} porciones</span>
          </div>
          <div class="meta-badge 
            {% if receta.dificultad.nivel|lower == 'fácil' %}easy
            {% elif receta.dificultad.nivel|lower == 'medio' %}medium
            {% else %}hard{% endif %}">
            {{ receta.dificultad.nivel }}
          </div>
        </div>

        <button class="btn btn-save-recipe {% if is_favorite %}active{% endif %}" data-recipe-id="{{ receta.id }}">
         <i class="{% if is_favorite %}fas{% else %}far{% endif %} fa-star"></i>
         {% if is_favorite %}Receta guardada{% else %}Guardar receta{% endif %}
        </button> 
      </div>
    </div>

    <!-- Center Column: Ingredientes -->
    <div class="recipe-center-column">
      <div class="section-header">
        <h3 class="section-title">Ingredientes</h3>
      </div>

      <div class="ingredients-list">
        {% for ri in receta.recetaingrediente_set.all %}
        <div class="ingredient-item">
          <i class="fas fa-shopping-cart item-icon"></i>
          <span class="ingredient-name">{{ ri.ingrediente.nombre_singular }}</span>
          <span class="ingredient-amount">
            {% if ri.cantidad %}{{ ri.cantidad }}{% endif %}
            {% if ri.unidad_medida %} {{ ri.unidad_medida.nombre }}{% endif %}
          </span>
        </div>
        {% empty %}
        <p class="no-ingredients">No hay ingredientes registrados para esta receta.</p>
        {% endfor %}
      </div>
    </div>

    <!-- Right Column: Instrucciones -->
    <div class="recipe-right-column">
      <div class="section-header">
        <h3 class="section-title">Instrucciones</h3>
      </div>

      <div class="instructions-list">
        {% for paso in receta.pasoinstruccion_set.all %}
        <div class="instruction-step">
          <div class="step-number">{{ paso.orden }}</div>
          <div class="step-content">
            <p>{{ paso.texto }}</p>
          </div>
        </div>
        {% empty %}
        <p class="no-instructions">Aún no se han agregado instrucciones.</p>
        {% endfor %}
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/recipe-detail.js' %}"></script>
{% endblock %}
