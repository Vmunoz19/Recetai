{% extends 'base.html' %}
{% load static %}

{% block title %} Módulo de Recetas - RecetaAI {% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/recipes.css' %}?v=1.1" />
{% endblock %}

{% block content %}
<div class="recipes-container">
  <!-- Header -->
  <header class="recipes-header">
    <div class="header-content">
      <div class="header-title">
        <h1>Módulo de Recetas</h1>
        <p class="subtitle">
          Explora todas las recetas disponibles en nuestra base de datos
        </p>
      </div>
      <div class="header-actions">
        <!-- filtros inline: el bloque completo de búsqueda aparece en la sección superior -->
      </div>
    </div>
  </header>
  <!-- (panel movido dentro del header-actions) -->
  <!-- Filters panel inline (visible siempre) -->
  <div class="filters-panel inline" aria-hidden="false">
    <form method="get" class="filters-form">
      <div class="filters-row">
        <input type="text" name="q" placeholder="Buscar por nombre..." value="{{ q }}" />

        <label>Porciones
          <input type="number" name="porciones" min="1" step="1" value="{{ selected_porciones }}" />
        </label>

        <label>Duración (min)
          <input type="number" name="min_duration" min="0" step="1" value="{{ selected_min_duration }}" />
        </label>

        <label>Duración (max)
          <input type="number" name="max_duration" min="0" step="1" value="{{ selected_max_duration }}" />
        </label>
      </div>

      <div class="filters-row">
        <label>Dificultad
          <select name="dificultad">
            <option value="">-- Cualquiera --</option>
            {% for d in dificultades %}
              <option value="{{ d.id }}" {% if selected_dificultad == d.id|stringformat:"s" %}selected{% endif %}>{{ d.nivel }}</option>
            {% endfor %}
          </select>
        </label>

        <label>Categoría
          <select name="categoria">
            <option value="">-- Cualquiera --</option>
            {% for c in categorias %}
              <option value="{{ c.id }}" {% if selected_categoria == c.id|stringformat:"s" %}selected{% endif %}>{{ c.nombre }}</option>
            {% endfor %}
          </select>
        </label>

        <div class="filters-actions">
          <button type="submit" class="btn btn-primary">Filtrar</button>
          <a href="{% url 'core:recipes' %}" class="btn btn-secondary">Limpiar</a>
        </div>
      </div>
    </form>
  </div>

  <!-- Recipes List -->
  <div class="recipes-list">
    {% for r in recipes %}
    <article class="recipe-card">
      <div class="recipe-image">
        {% if r.image_url %}
          <img src="{{ r.image_url }}" alt="{{ r.nombre }}" />
        {% else %}
          <img src="{% static 'media/placeholders/recipe-placeholder.jpg' %}" alt="{{ r.nombre }}" />
        {% endif %}
      </div>

      <div class="recipe-content">
        <div class="recipe-header">
          <h2 class="recipe-title">{{ r.nombre }}</h2>
          <div class="recipe-rating">
            <i class="fas fa-star"></i>
            <span>{{ r.valoracion|default:"0.0" }}</span>
          </div>
        </div>

        <div class="recipe-meta">
          <div class="meta-item">
            <i class="far fa-clock"></i>
            <span>{% if r.duracion %}{{ r.duracion }} min{% else %}-{% endif %}</span>
          </div>
          <div class="meta-item">
            <i class="fas fa-users"></i>
            <span>{{ r.porciones }} porciones</span>
          </div>
          <div class="meta-badge 
            {% if r.dificultad.nivel|lower == 'fácil' %}easy
            {% elif r.dificultad.nivel|lower == 'medio' %}medium
            {% else %}hard{% endif %}">
            {{ r.dificultad.nivel }}
          </div>
        </div>

        <div class="recipe-tags">
          {% for cat in r.categorias.all %}
            <span class="tag-label">
              <i class="fas fa-tag"></i>
              {{ cat.nombre }}
            </span>
          {% empty %}
            <span class="tag-label">
              <i class="fas fa-tag"></i> Sin categoría
            </span>
          {% endfor %}
        </div>

        <div class="recipe-actions">
          <a href="{% url 'core:recipe_detail' r.id %}" class="btn-view">
            Ver receta
          </a>
          <button
  class="btn-favorite {% if r.id in favorite_ids %}active{% endif %}"
  data-recipe-id="{{ r.id }}"
  title="Marcar como favorita"
  >
  <i class="{% if r.id in favorite_ids %}fas{% else %}far{% endif %} fa-heart"></i>
</button>
        </div>
      </div>
    </article>
    {% empty %}
    <p class="no-recipes">No se encontraron recetas.</p>
    {% endfor %}
  </div>

  <!-- Pagination -->
  <nav class="pagination-container">
  {% if recipes.has_previous %}
    <a href="?page={{ recipes.previous_page_number }}{% if querystring %}&{{ querystring }}{% endif %}"
       class="pagination-btn">← Anterior</a>
  {% endif %}

  <span class="pagination-info">
    Página <strong>{{ recipes.number }}</strong> de {{ recipes.paginator.num_pages }}
  </span>

  {% if recipes.has_next %}
    <a href="?page={{ recipes.next_page_number }}{% if querystring %}&{{ querystring }}{% endif %}"
       class="pagination-btn">Siguiente →</a>
  {% endif %}
  </nav>

</div>
{% block extra_js %}
<script src="{% static 'js/recipe.js' %}?v=1.0"></script>
{% endblock %}
{% endblock %}
